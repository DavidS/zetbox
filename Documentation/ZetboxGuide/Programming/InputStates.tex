\subsection{States of an Input Control}

\emph{Input controls} are Views receiving input from the user. The following state diagram 
explains the possible basic states of the underlying \emph{InputViewModel}:

\input{Programming/Diagrams/InputStates.tex}

An InputViewModel has two distinct dimensions along which it modifies its behaviour. One is 
whether or not it currently has the focus\footnote{usually the keyboard focus}. The other 
dimension is whether or not there are outstanding (partial) modifications to the Value.

\begin{description}
\item[B] {The ViewModel is \emph{blurred}. That is, it does not have the focus. User input will not
 reach the control.}
\item[F] {The ViewModel is \emph{focused}. That is, it has the focus. The control will be notified
 of the user's next input.}
\item[IF] {The ViewModel is \emph{implicitely focused}. This states is reached by signalling user
 input without first signalling a focusing event. It is a convenient shortcut for Toolkits which do
 not track the concept of focus. Since this state is unaware of the user's focus, it has to bubble
 changes to the canonically formatted Value immediately to the View, possibly disrupting the user's
 input.}

\item[UV] {The View should display the \emph{unmodified Value}. This is the common state when no input was received or all input was processed successfully.}
\item[PUI] {The View should display a \emph{partial user input}. If the user cannot input a valid value atomically, the ViewModel will enter this state to keep track of the partial value to add more input from the user until a valid value is formed.}
\item[WM] {The ViewModel is currently \emph{writing to the Model}. Change notifications from the Model in this state are generated by the writing ViewModel and thus must be ignored locally.}
\end{description}

There are several events that determine the actual state of the InputViewModel.

\begin{description}
\item[F] {The ViewModel receives \emph{Focus}.}
\item[B1] {The ViewModel looses \emph{Focus}. Since this signals the user loosing interest in 
further editing this Value, a change in the FormattedValue is signalled\footnote{If the user has not
modified the Value, this signalling could be optimized away. Since the canonical representation 
should always be on display unless the user is currently editing this is not deemed an issue at this
time.} to update the View to the canonical representation of the Value.}
\item[B2] {The ViewModel looses \emph{Focus}. Since the user has still a pending partial input, the 
ViewModel expects the user to return and continue editing.}
\item[MC1] {The Model is \emph{changed} by a third party. This might be due to changes from the business 
logic or via other ViewModels. In any case the View should be signalled to update its display to 
the new Value.}
\item[MC2] {The Model is \emph{changed} by a third party. The user is currently editing the Value, so 
changes there should be ignored. In most cases this constitutes a programming error, as no code 
should try to change values while the user is editing them.}
\item[MC3] {The Model is \emph{changed} by the ViewModel. The View should be signalled to update its 
display to the new Value. Since this is in reaction to user input, this might not display a 
canonicalized value}
\item[PI] {The user enters \emph{partial input}. The ViewModel will store this until the user
completes or aborts\footnote{Canceling is currently not supported} her edit.}
\item[VI] {The user enters \emph{complete input}. The ViewModel accepts the input as valid and will
proceed to write it back to the Model.}
\end{description}
